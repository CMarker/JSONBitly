javascript:(function(){var embeddedBody='<style type="text/css" media="screen">\n    #editor { position: relative; margin: 10px; min-height: 93%; display: flex; }\n    #footer { position: relative; margin: 10px;}\n</style>\n<body style="background-color: gray; height: 100%">\n    <div id="nav" style="margin: 5px">\n        <span class="col-md-2"></span>\n        <span class="col-md-2"></span>\n        <span class="col-md-4">\n            <button id="pretty" class="gen_btn">Pretty</button>\n            <button id="ugly" class="gen_btn">Ugly</button>\n            <button id="copy" class="gen_btn">Copy</button>\n            <button id="export" class="gen_btn">Export</button>\n            <b><span id="valid"></span></b>\n        </span>\n        <span>Selector: </span><b><span id="selector">selector</span></b>\n    </div>\n    <div id=""></div>\n    <div id="editor"></div>\n    <div id="footer"></div>\n</body>',embeddedScript='function json2csv(input) {\n    var CSV = \'\';\n    var array = typeof input != \'object\' ? JSON.parse(input) : input;\n    var isArray = array.length ? true : false;\n    if (isArray) {\n        for (var index in array[0]) {\n            CSV += index + \',\';\n        }\n    } else {\n        for (var index in array) {\n            CSV += index + \',\';\n        }\n    }\n    CSV = CSV.slice(0, -1);\n    CSV += \'\\r\\n\';\n\n    if (isArray) {\n        for (var i = 0; i < array.length; i++) {\n            var row = "";\n            for (var index in array[i]) {\n                var val = array[i][index];\n                if (typeof val == "object")\n                    val = "object";\n                row += val + \',\';\n            }\n            row = row.slice(0, -1);\n            CSV += row + \'\\r\\n\';\n        }\n    } else {\n        var row = "";\n        for (var index in array) {\n            var val = array[index];\n            if (typeof val == "object")\n                val = "object";\n            row += val + \',\';\n        }\n        row = row.slice(0, -1);\n        CSV += row + \'\\r\\n\';\n    }\n\n    return CSV;\n}\n\nfunction copyTextToClipboard(text) {\n    var copyFrom = $(\'<textarea/>\');\n    copyFrom.text(text);\n    $(\'body\').append(copyFrom);\n    copyFrom.select();\n    document.execCommand(\'copy\');\n    copyFrom.remove();\n}\n\n$( document ).ready(function() {\n    console.log("It\'s formatting time.");\n    var valid = false;\n    var editor = ace.edit("editor");\n    editor.setTheme("ace/theme/monokai");\n    editor.getSession().setMode("ace/mode/json");\n    editor.$blockScrolling = Infinity;\n    window.editor = editor;\n    if (window.json) {\n        var val = json;\n        var o = JSON.parse(val);\n        val = JSON.stringify(o, null, 4);\n        if (val) {\n            editor.session.setValue(val);\n            valid = true;\n            updateValid();\n        }\n    }\n\n    function updateValid() {\n        if (valid) {\n            $(\'#valid\').text("VALID");\n        } else {\n            $(\'#valid\').text("INVALID");\n        }\n    }\n    function getJSONSelector() {\n        var selectorParts = [];\n        var lineNumber = editor.getSelectionRange().start.row;\n        var lineString = editor.session.getLine(lineNumber);\n        var clean = lineString.slice(lineString.indexOf("\\"")+1);\n        clean = clean.slice(0, clean.indexOf("\\""));\n        selectorParts.push(clean);\n\n        var prevSpaceCount = lineString.search(/\\S/);\n        var x=lineNumber-1;\n        while (x >= 0) {\n            var rootSpaceCount = lineString.search(/\\S/);\n            for (x;x>=0;x--) {\n                rootSpaceCount = lineString.search(/\\S/);\n                var testString = editor.session.getLine(x);\n                var spaceCount = testString.search(/\\S/);\n                if (testString.trim().indexOf("{") != -1 && spaceCount < rootSpaceCount) {\n                    selectorParts.push(".");\n                }\n                if (testString.trim().indexOf(\'[\') != -1 && spaceCount < rootSpaceCount) {\n                    selectorParts.push("[x]");\n                }\n\n                if (spaceCount < rootSpaceCount){\n                    var clean = testString.slice(testString.indexOf("\\"")+1);\n                    clean = clean.slice(0, clean.indexOf("\\"")).trim();\n                    if (clean != "")\n                        selectorParts.push(clean);\n                    lineString = editor.session.getLine(x);\n                    break;\n                }\n                if (spaceCount < rootSpaceCount){\n                    lineString = editor.session.getLine(x);\n                }\n            }\n        }\n\n        var selector = "";\n        for(x=selectorParts.length-1;x>=0;x--) {\n            selector += selectorParts[x];\n        }\n\n        return selector;\n    }\n\n    editor.on("changeSelection", function(){\n        var selector = getJSONSelector();\n        //console.log("selector: " + selector);\n        $(\'#selector\').text(selector);\n    });\n\n    editor.on("change", function(e) {\n        var val = editor.session.getValue();\n        valid = false;\n        try {\n            var o = JSON.parse(val);\n            val = JSON.stringify(o, null, 4);\n            if (val) {\n                valid = true;\n            }\n        } catch (err){\n\n        }\n\n        updateValid();\n    });\n\n    $("#pretty").click(function(){\n        console.log("Prettying up");\n        var val = editor.session.getValue();\n        valid = false;\n        try {\n            var o = JSON.parse(val);\n            val = JSON.stringify(o, null, 4);\n            if (val) {\n                valid = true;\n                process = false;\n                editor.session.setValue(val);\n                process = true;\n            }\n        } catch (err){\n\n        }\n\n        updateValid();\n    });\n\n    $("#ugly").click(function(){\n        console.log("Ugly up");\n        var val = editor.session.getValue();\n        valid = false;\n        try {\n            var o = JSON.parse(val);\n            val = JSON.stringify(o);\n            if (val) {\n                valid = true;\n                process = false;\n                editor.session.setValue(val);\n                process = true;\n            }\n        } catch (err){\n\n        }\n\n        updateValid();\n    });\n\n    $("#export").click(function(){\n        if (!valid) {\n            alert(\'Invalid json\');\n            return;\n        }\n\n        var fileName = prompt("Enter filename", "file.csv");\n        if (!fileName) {\n            return;\n        }\n\n        var val = editor.session.getValue();\n        var CSV = json2csv(val);\n        //console.log("CSV: " + CSV);\n        //return;\n\n\n        var uri = \'data:text/csv;charset=utf-8,\' + escape(CSV);\n        var link = document.createElement("a");\n        link.href = uri;\n        link.style = "visibility:hidden";\n        if (fileName.indexOf(".csv") == -1)\n            fileName = fileName + ".csv";\n        link.download = fileName;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n    });\n\n    $("#copy").click(function(){\n        copyTextToClipboard(editor.session.getValue());\n    })\n});',newhtml='<!DOCTYPE html><html lang="en" style="height: 100%;"><head><title>JSONBitly</title> <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.9/ace.js" type="text/javascript" charset="utf-8"></script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js" type="text/javascript" charset="utf-8"></script> <link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.js"></script><script>'+embeddedScript+"</script> </head> "+embeddedBody+"</html>",data=btoa(newhtml),datauri="data:text/html;base64,"+data,redirectWindow=window.open(datauri,"_blank");redirectWindow.location;})();